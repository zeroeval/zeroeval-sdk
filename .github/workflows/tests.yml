name: ğŸ§ª Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    name: Python ${{ matrix.python-version }}
    runs-on: ubuntu-latest
    
    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.9", "3.10", "3.11", "3.12"]
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ Install uv
      uses: astral-sh/setup-uv@v3
      with:
        version: "latest"

    - name: ğŸ”§ Set up Python ${{ matrix.python-version }}
      run: uv python install ${{ matrix.python-version }}

    - name: ğŸ“¦ Install dependencies
      run: uv sync --dev

    - name: ğŸ§ª Run Core Tests
      run: |
        echo "::group::ğŸ§ª Core SDK Tests"
        uv run pytest tests/ -m "core" -v --tb=short --color=yes
        echo "::endgroup::"

    - name: ğŸ”— Run Compatibility Tests
      run: |
        echo "::group::ğŸ”— Compatibility Tests"
        uv run pytest tests/ -m "compatibility" -v --tb=short --color=yes
        echo "::endgroup::"

    - name: ğŸ‘ï¸ Run Observability Tests
      run: |
        echo "::group::ğŸ‘ï¸ Observability Tests"
        uv run pytest tests/ -m "observability" -v --tb=short --color=yes
        echo "::endgroup::"

    - name: ğŸƒâ€â™‚ï¸ Run All Tests (Summary)
      run: |
        echo "::group::ğŸƒâ€â™‚ï¸ Full Test Suite"
        uv run pytest tests/ -v --tb=short --color=yes --durations=10
        echo "::endgroup::"

    - name: âœ… Test Summary
      if: success()
      run: |
        echo "::notice::âœ… All tests passed on Python ${{ matrix.python-version }}!"
        echo "- Core tests: PASSED"
        echo "- Compatibility tests: PASSED"
        echo "- Observability tests: PASSED" 